{% extends 'admin_loja/base_admin_loja.html' %}

{% block header %}
<h1><i class="fas fa-life-ring"></i> Suporte e Ajuda</h1>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Chat de Suporte -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-comments"></i> Chat de Suporte</h5>
            </div>
            <div class="card-body">
                <div id="chat-container" style="height: 300px; overflow-y: auto; border: 1px solid #dee2e6; padding: 10px; margin-bottom: 10px;">
                    <div class="chat-message bot-message">
                        <strong>Suporte:</strong> Olá! Como posso ajudá-lo hoje?
                        <small class="text-muted d-block">{{ "now"|date:"H:i" }}</small>
                    </div>
                </div>
                
                <div class="input-group">
                    <input type="text" id="chat-input" class="form-control" placeholder="Digite sua mensagem..." maxlength="500">
                    <button class="btn btn-primary" id="chat-send" type="button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i> 
                        Para suporte personalizado, 
                        <a href="{% url 'admin_loja:suporte_contato' %}">envie um ticket</a>
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ações Rápidas -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-bolt"></i> Ações Rápidas</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <a href="{% url 'admin_loja:suporte_contato' %}" class="btn btn-outline-primary btn-lg w-100">
                            <i class="fas fa-ticket-alt d-block mb-2" style="font-size: 2rem;"></i>
                            <strong>Abrir Ticket</strong>
                            <small class="d-block">Enviar solicitação detalhada</small>
                        </a>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <a href="mailto:suporte@menuly.com.br" class="btn btn-outline-success btn-lg w-100">
                            <i class="fas fa-envelope d-block mb-2" style="font-size: 2rem;"></i>
                            <strong>Email Direto</strong>
                            <small class="d-block">suporte@menuly.com.br</small>
                        </a>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <a href="tel:+5511999999999" class="btn btn-outline-warning btn-lg w-100">
                            <i class="fas fa-phone d-block mb-2" style="font-size: 2rem;"></i>
                            <strong>Telefone</strong>
                            <small class="d-block">(11) 99999-9999</small>
                        </a>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <a href="https://wa.me/5511999999999" target="_blank" class="btn btn-outline-success btn-lg w-100">
                            <i class="fab fa-whatsapp d-block mb-2" style="font-size: 2rem;"></i>
                            <strong>WhatsApp</strong>
                            <small class="d-block">Atendimento rápido</small>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- FAQ -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-question-circle"></i> Perguntas Frequentes (FAQ)</h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="faqAccordion">
                    {% for categoria in faq_data %}
                    <div class="accordion-item mb-3">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq-{{ forloop.counter }}" aria-expanded="false">
                                <strong>{{ categoria.categoria }}</strong>
                            </button>
                        </h2>
                        <div id="faq-{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                {% for item in categoria.perguntas %}
                                <div class="mb-3">
                                    <h6 class="text-primary">{{ item.pergunta }}</h6>
                                    <p class="text-muted small">{{ item.resposta }}</p>
                                </div>
                                {% if not forloop.last %}<hr>{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tutoriais -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-graduation-cap"></i> Tutoriais Passo a Passo</h5>
            </div>
            <div class="card-body">
                {% for tutorial in tutoriais_data %}
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-play-circle text-primary"></i> 
                            {{ tutorial.titulo }}
                        </h6>
                        <p class="card-text text-muted">{{ tutorial.descricao }}</p>
                        <small class="text-muted">
                            <i class="fas fa-clock"></i> {{ tutorial.duracao }}
                        </small>
                        
                        <button class="btn btn-sm btn-outline-primary float-end" type="button" data-bs-toggle="collapse" data-bs-target="#tutorial-{{ forloop.counter }}">
                            Ver Passos
                        </button>
                        
                        <div class="collapse mt-3" id="tutorial-{{ forloop.counter }}">
                            <ol class="list-group list-group-numbered">
                                {% for passo in tutorial.passos %}
                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                        <div class="fw-bold">Passo {{ forloop.counter }}</div>
                                        {{ passo }}
                                    </div>
                                </li>
                                {% endfor %}
                            </ol>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
.chat-message {
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 8px;
    background: #f8f9fa;
}

.user-message {
    background: #007bff;
    color: white;
    text-align: right;
}

.bot-message {
    background: #e9ecef;
}

.btn-lg {
    padding: 1rem;
    text-align: center;
}

.btn-lg i {
    opacity: 0.7;
}

.accordion-button {
    font-weight: 500;
}

.list-group-numbered {
    --bs-list-group-numbered-line-height: 1.4;
}

.card {
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.card-header {
    font-weight: 600;
    border-bottom: 1px solid rgba(0,0,0,.125);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatInput = document.getElementById('chat-input');
    const chatSend = document.getElementById('chat-send');
    const chatContainer = document.getElementById('chat-container');
    
    function addMessage(message, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${isUser ? 'user-message' : 'bot-message'}`;
        
        const now = new Date();
        const timeStr = now.toTimeString().slice(0, 5);
        
        messageDiv.innerHTML = `
            <strong>${isUser ? 'Você' : 'Suporte'}:</strong> ${message}
            <small class="text-muted d-block">${timeStr}</small>
        `;
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;
        
        addMessage(message, true);
        chatInput.value = '';
        
        // Simular resposta do bot
        setTimeout(() => {
            fetch('{% url "admin_loja:suporte_chat_api" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({mensagem: message})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addMessage(data.resposta);
                } else {
                    addMessage('Desculpe, ocorreu um erro. Tente novamente.');
                }
            })
            .catch(() => {
                addMessage('Erro de conexão. Verifique sua internet.');
            });
        }, 1000);
    }
    
    chatSend.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
});
</script>

<!-- Bootstrap JavaScript para accordion e collapse -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}